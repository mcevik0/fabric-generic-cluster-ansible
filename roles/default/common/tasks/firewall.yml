---
# roles/default/common/tasks/firewall.yml
# Basic firewall configuration

- name: Ensure firewalld is installed (RedHat)
  dnf:
    name: firewalld
    state: present
  when: ansible_os_family == "RedHat"
  tags: firewall

- name: Ensure ufw is installed (Debian)
  apt:
    name: ufw
    state: present
  when: ansible_os_family == "Debian"
  tags: firewall

- name: Enable and start firewalld (RedHat)
  systemd:
    name: firewalld
    enabled: yes
    state: started
  when: 
    - ansible_os_family == "RedHat"
    - firewall_enabled | default(false)
  tags: firewall

- name: Configure firewalld - allow SSH (RedHat)
  firewalld:
    service: ssh
    permanent: yes
    state: enabled
    immediate: yes
  when: 
    - ansible_os_family == "RedHat"
    - firewall_enabled | default(false)
  tags: firewall

- name: Enable ufw (Debian)
  ufw:
    state: enabled
    policy: deny
  when: 
    - ansible_os_family == "Debian"
    - firewall_enabled | default(false)
  tags: firewall

- name: Configure ufw - allow SSH (Debian)
  ufw:
    rule: allow
    port: '22'
    proto: tcp
  when: 
    - ansible_os_family == "Debian"
    - firewall_enabled | default(false)
  tags: firewall
